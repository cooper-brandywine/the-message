const firebaseConfig={apiKey:"AIzaSyBDLxkVBqmQA44SPMFZ7hxGEx2Uh02H2ds",authDomain:"edit-post.firebaseapp.com",projectId:"edit-post",storageBucket:"edit-post.firebasestorage.app",messagingSenderId:"5893895762",appId:"1:5893895762:web:cf4b5744e4d382ec3d118b",measurementId:"G-EK4BYMJW9C"};firebase.initializeApp(firebaseConfig);const db=firebase.database(),postsRef=db.ref("posts");if(Notification.permission!=="granted"){Notification.requestPermission().then(p=>{console.log("Notification permission:",p)})}let previousMessage=null;function updateUI(data){let html="";if(data){const postsArray=Object.keys(data).map(k=>data[k]);postsArray.sort((a,b)=>a.timestamp-b.timestamp);postsArray.forEach(post=>{const date=new Date(post.timestamp).toLocaleString();html+="<div class='post'><div class='post-message'>"+(post.message||"")+"</div><div class='post-timestamp'>"+date+"</div></div>"});
const lastPost=postsArray[postsArray.length-1];if(previousMessage!==null&&previousMessage!==lastPost.message){if(Notification.permission==="granted")new Notification("New Post",{body:lastPost.message})}previousMessage=lastPost.message}else{html="No posts found."}document.getElementById("display").innerHTML=html}postsRef.on("value",snapshot=>{updateUI(snapshot.val())});function canPost(){return postsRef.orderByChild("timestamp").limitToLast(1).once("value").then(snapshot=>{let allow=true;snapshot.forEach(child=>{const lastPost=child.val();if(lastPost&&lastPost.timestamp){if(Date.now()-lastPost.timestamp<60000){allow=false}}});return allow})}document.getElementById("postForm").addEventListener("submit",function(e){e.preventDefault();const text=document.getElementById("postText").value.trim();if(text.length>256){alert("Message exceeds 256 characters.");return}canPost().then(allowed=>{if(!allowed){alert("Please wait a minute before posting again.");return}const newPost={message:text,timestamp:Date.now()};postsRef.push(newPost).then(()=>{document.getElementById("postText").value=""}).catch(error=>{alert("Error posting message.");console.error(error)})})});function updateTimer(){postsRef.orderByChild("timestamp").limitToLast(1).once("value").then(snapshot=>{let secondsLeft=0;snapshot.forEach(child=>{const lastPost=child.val();if(lastPost&&lastPost.timestamp){const diff=Date.now()-lastPost.timestamp;if(diff<60000){secondsLeft=Math.ceil((60000-diff)/1000)}}});if(secondsLeft>0){document.getElementById("timer").textContent="Next post available in "+secondsLeft+" seconds.";document.getElementById("postText").disabled=true;document.querySelector("#postForm button").disabled=true}else{document.getElementById("timer").textContent="";document.getElementById("postText").disabled=false;document.querySelector("#postForm button").disabled=false}})}setInterval(updateTimer,1000);